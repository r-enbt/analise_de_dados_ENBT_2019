---
title: "Disciplina: Projetos de análise de dados usando R"
subtitle: "Dia 5: R para biólogos, ecólogos e taxonomistas"
author: "Andrea Sánchez-Tapia, Sara Mortara, Diogo S. B. Rocha"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

# As respostas que vocês deram
 

+ Análise exploratória
+ Modelos lineares
+ Análise multivariada
+ Análises filogenéticas
+ Mapas e sistemas de informação geográfica
+ Modelos de nicho ecológico

---

# Como começar?


---
# Análise multivariada

+ Estudando - R não resolve nada por si só
+ Livros da área: Legendre & Legendre Numerical ecology - Borcard et al 1999 Numerical ecology using R 
+ A seção de métodos dos artigos científicos
+ As __vignettes__ dos pacotes 
+ As páginas web (__ISSO AINDA EXISTE__) dos autores - Legendre lab, Oksanen 
+ google
+ researchgate
+ Os coleguinha
+ stack overflow (mas nem sempre funciona para temas acadêmicos)

---

# R Task views

alguns pacotes organizados por temas, curados por um especialista
 
 https://cran.r-project.org/web/views/
https://cran.r-project.org/web/views/Multivariate.html


---
# Análise multivariada em R

+ Análise multivariada em geral: Legendre & Legendre - Numerical Ecology
+ Cajo Ter Braak
+ Página do Legendre Lab
+ Página do Jari Oksanen
+ Help do pacote vegan

```
library(vegan)
citation(vegan)
```

---

# Alguns pacotes de análise multivariada em R

--
+ Quais pacotes? 

+ Com calcular medidas de distância?

+ Como fazer classificação, análises de agrupamento (_cluster analysis_)?

+ Análise de componentes principais

+ Como e onde executar outros métodos de ordenação?

---

# Alguns pacotes de análise multivariada em R

+ Quais pacotes? __vegan__ e __ade4__, __factomineR__ entre outros

+ Como calcular medidas de distância? __dist()__ de base, [vegdist()]() de vegan

+ Como fazer classificação, análises de agrupamento (_cluster analysis_)? [hclust]() de stats - 

+ Análise de componentes principais `stats::prcomp()`, `vegan::rda()`

+ Como e onde executar outros métodos de ordenação?

+ Classificação: `stats::hclust()`.

+ vegan Oksanen et al 

+ `ade4` - grupo francês

+ factomineR

---

# Análise multivariada em R
Quais medidas de distância e por quê? qual método de agrupamento e por quê? 
Qual método de ordenação e por quê? 

`¯\_(ツ)_/¯`


---

# Análise de diversidade

--
## Diversidade taxonômica

+ Índices clássicos de diversidade: Shannon, Simpson, com `diversity()`
+ We <3 `vegan ()` sempre - 

Scripts de artigos científicos

--
## Diversidade funcional

Pacotes FD, vegan, labDSV, 
Literatura científica: Sandrine Pavoine, Carlo Ricotta, André Dias, Francesco de Bello entre outros. Scripts com cálculos de índices de diversidade, comparação entre medidas de diversidade funcional e filogenética etc. 


---
# Formato dos dados

```{r, echo = F, eval = F}
library(vegan)
library(tidyr)
library(dplyr)
BCI %>% tibble::rownames_to_column("parcela") %>%
  gather(especie, n, -1) %>% arrange(parcela) %>% write.csv("./aula10/data/BCI.csv")
```

```{r, echo = F}
bci <- read.csv("./data/BCI.csv", row.names = 1)
head(bci)
tail(bci)
```
---
## Precisamos do formato com as espécies nas colunas

```{r}
length(unique(bci$especie))
com_matrix <- tidyr::spread(bci, especie, n,
                            fill = 0)
head(com_matrix[,1:4])
```

---

```{r}
com_matrix <- tibble::column_to_rownames(com_matrix, "parcela")
head(com_matrix[,1:4])
```

---
![]("./figs/4thcorner.jpg")

---
## Análises filogenéticas

+ Como é um _workflow_ de análise em filogenia? 
+ Em ecologia, ler, modificar e escrever árvores filogenéticas, plotar, anotar.
+ Árvores filogenéticas: formatos Nexus e Newick

```
((A, B), C);
```

---
## Análises filogenéticas

Estrutura de dados

```{r, message=FALSE}
library(picante)
data(phylocom)
names(phylocom)

phy <- phylocom$phylo
comm <- phylocom$sample
traits <- phylocom$traits

```

---
## Filogenia

```{r }
phy
```

---
## Dados de comunidade


```{r }
comm[,1:13]

```

---
## 


--- 
## Dados de atributos

```{r }
head(traits)

traitA <- df2vec(traits, "traitA")
head(traitA)
```

---
## Visualizando árvores e dados


```{r }
prunedphy <- prune.sample(comm, phy)
prunedphy
```

---
## Visualizando uma árvore


```{r, eval=FALSE }
par(mfrow = c(2, 2))
for (i in names(traits)) {
plot(phy, show.tip.label = FALSE, main = i)
7
tiplabels(pch = 22, col = traits[, i] + 1, bg = traits[, i] + 1, cex = 1.5)
}
```


---
## Visualizando uma árvore


```{r, echo=FALSE}
par(mfrow = c(2, 2))
for (i in names(traits)) {
plot(phy, show.tip.label = FALSE, main = i)
7
tiplabels(pch = 22, col = traits[, i] + 1, bg = traits[, i] + 1, cex = 1.5)
}
```

---
## Diversidade filogenética

```{r }
pd.result <- pd(comm, phy, include.root = TRUE)
pd.result
```

---
## Distância filogenética média MPD e sesMPD

```{r }
phydist <- cophenetic(phy)
phydist[1:13,1:13]
```

---
## Distância filogenética média MPD e sesMPD

```{r }
ses.mpd.result <- ses.mpd(comm, phydist, null.model = "taxa.labels",
                          abundance.weighted = FALSE, runs = 99)
ses.mpd.result
```

---
## Modelos lineares (lm), modelos lineares generalizados (glm) e modelos lineares generalizados mistos (glmm)

+ Ben Bolker <3: [Ecological Models and Data in R](http://emdbolker.wikidot.com/)

+ Michael Crawley: [The R Book](https://onlinelibrary.wiley.com/doi/book/10.1002/9781118448908)

+ Alain Zuur: [Highland Statistics Ltd.](https://www.highstat.com/)

+ Burnham & Anderson: [Model Selection and Multimodel Inference](https://www.springer.com/gp/book/9780387953649)


---
## Pacotes (g)lm(m)

+ `stats` e `MASS` no R base com funções `lm` e `glm`

+ `lme4` para modelos mistos

+ `MuMIn` para seleção de modelos

+  `bbmle` ferramentas para modelagem B.Bolker <3 

+ `MCMCglmm`, `glmmTMB` pacotes só com consoantes 

---
## Modelagem de nicho ecológico

+ Peterson et al 
+ Quais pacotes?
    biomod2, dismo, sdm, wallace, kuenm
+ Pacotes acessórios
ENMeval, spThin, presenceabsence

    bisso grupo tem um fluxo de trabalho que empacota várias 
    
+ Input necessário: 
    + Arquivos raster de variáveis explicativas
    + Coordenadas de ocorrência
    
+ Os pacotes: preparação dos dados, limpeza, partição dos dados em dados de treino e teste dos algoritmos, algoritmos, medidas de desempenho e avaliação. 



---
# Instalar pacotes


```{r, eval =F}
install.packages("vegan")
```

```{r, eval =T}
library("vegan")
citation("vegan")
```

---

# O help de `R`

* `R` possui ampla documentação de cada função e pacote.

```{r,eval = FALSE}
?anova
??anova
help(anova)
```

* A estrutura do help é sempre similar: Description, Usage, Arguments... Details, Notes, References, See Also, Examples 

* O uso de todas as funções é:   
`nome da função(argumentos)`

---
# Onde buscar ajuda?

+ A pessoa do seu lado.
+ Colegas mais experientes
+ google
+ Stack Overflow: leia bem as instruções para postar perguntas e tente dar exemplos
+ A lista de emails de `R`-help: um monte de pessoas lê e posta mas o tom pode ser um pouco seco. 
+ Os autores do pacote ou os repositórios de github 
+ A comunidade de RStudio community.rstudio.com
+ Listas de emails específicas (GIS, phylogenetics, etc…)
+ Twitter, hashtag `#rstats`


http://datacarpentry.org/semester-biology/materials/googling-for-help/  
http://community.rstudio.com


